!function(e){"use strict";function i(e){return this.id="viewer-"+Math.round(Math.random()*Math.pow(10,6)).toString(),this.viewerOpen=!1,this.figure=e,this.scrim=document.getElementsByClassName("scrim")[0],this.lastWindowWidth=window.innerWidth,this.transitionEndEvent=function(){var e,i=document.createElement("fakeelement"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",MSTransition:"msTransitionEnd",OTransition:"otransitionend",transition:"transitionend"};for(e in t)if(t.hasOwnProperty(e)&&void 0!==i.style[e])return t[e]}(),this.forceSmall=0<=this.figure.className.indexOf("force-small"),this.forceMedium=0<=this.figure.className.indexOf("force-medium"),this.forceLarge=0<=this.figure.className.indexOf("force-large"),window.addEventListener("keyup",function(e){27===e.keyCode&&this.closeViewer()}.bind(this)),this.load(),0<=this.figure.className.indexOf("with-viewer")&&this.figure.addEventListener("click",this.openViewer.bind(this)),this}i.prototype.closeViewer=function(){window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onShouldCloseViewer),window.removeEventListener("orientationchange",this.onShouldCloseViewer),this.scrim.removeEventListener("click",this.onShouldCloseViewer),this.figure.addEventListener(this.transitionEndEvent,function(){-1==document.body.className.indexOf(this.id)&&(this.viewerOpen=!1,this.figure.className=this.figure.className.replace("is-open","").replace(/^\s+|\s+$/g,""),this.figure.style.zIndex="")}.bind(this)),document.body.className=document.body.className.replace(this.id,"").replace(/^\s+|\s+$/g,""),this.figure.style.transform=""},i.prototype.openViewer=function(){var e,i,t,s,n,o,r,a;0<=document.body.className.indexOf(this.id)?this.closeViewer():(this.viewerOpen=!0,n=window.getComputedStyle(this.figure),e=parseFloat(n.height),i=parseFloat(n.width),t=window.innerHeight,s=window.innerWidth,n=this.figure.getBoundingClientRect(),i/e<=s/t?(r=(s-i*(o=t/e))/2-n.left,a=-1*n.top):(a=(t-e*(o=s/i))/2-n.top,r=-1*n.left),document.body.className+=" "+this.id,this.figure.className+=" is-open",this.figure.style.zIndex="800",this.figure.style.transform="translate3d("+r+"px,"+a+"px,0) scale("+o+")",setTimeout(function(){this.figure.className.indexOf("loaded-raw")<=0&&this.loadRaw()}.bind(this),300),this.onScroll=function(){var e=this.figure.getBoundingClientRect().top;50<Math.abs(e)&&this.closeViewer()}.bind(this),this.onShouldCloseViewer=function(e){this.closeViewer(),e.stopPropagation()}.bind(this),this.scrim.addEventListener("click",this.onShouldCloseViewer),window.addEventListener("resize",this.onShouldCloseViewer),window.addEventListener("orientationchange",this.onShouldCloseViewer),window.addEventListener("scroll",this.onScroll))},i.prototype.load=function(){var e=new Image;e.src=this.figure.dataset[this.getSize()],e.className="full",e.onload=function(){this.figure.className+=" loaded"}.bind(this),this.figure.appendChild(e)},i.prototype.loadRaw=function(){var e=new Image;e.src=this.figure.dataset.raw,e.className="raw",e.onload=function(){this.figure.className+=" loaded-raw"}.bind(this),this.figure.appendChild(e)},i.prototype.getSize=function(){if(this.forceSmall)return"small";if(this.forceMedium)return"medium";if(this.forceLarge)return"large";var e=this.lastWindowWidth<768?0:this.lastWindowWidth<1440?1:2;return 1<window.devicePixelRatio&&e<2&&(e+=1),["small","medium","large"][e]},"function"==typeof define&&define.amd?define(i):"undefined"!=typeof module&&module.exports?module.exports=i:e.ProgressiveImage=i}(this);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZ3Jlc3NpdmUtaW1hZ2UuanMiLCJzb3VyY2VzIjpbInByb2dyZXNzaXZlLWltYWdlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbihnbG9iYWwpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICAvKipcbiAgICAgKiBGaW5kIHRoZSBDU1MgdHJhbnNpdGlvbiBlbmQgZXZlbnQgdGhhdCB3ZSBzaG91bGQgbGlzdGVuIGZvci5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IHQgLSB0aGUgdHJhbnNpdGlvbiBzdHJpbmdcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBfd2hpY2hUcmFuc2l0aW9uRW5kRXZlbnQoKSB7XG4gICAgICAgIHZhciB0O1xuICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmYWtlZWxlbWVudCcpO1xuICAgICAgICB2YXIgdHJhbnNpdGlvbnMgPSB7XG4gICAgICAgICAgICBXZWJraXRUcmFuc2l0aW9uOiAnd2Via2l0VHJhbnNpdGlvbkVuZCcsXG4gICAgICAgICAgICBNb3pUcmFuc2l0aW9uOiAndHJhbnNpdGlvbmVuZCcsXG4gICAgICAgICAgICBNU1RyYW5zaXRpb246ICdtc1RyYW5zaXRpb25FbmQnLFxuICAgICAgICAgICAgT1RyYW5zaXRpb246ICdvdHJhbnNpdGlvbmVuZCcsXG4gICAgICAgICAgICB0cmFuc2l0aW9uOiAndHJhbnNpdGlvbmVuZCcsXG4gICAgICAgIH07XG4gICAgICAgIGZvciAodCBpbiB0cmFuc2l0aW9ucykge1xuICAgICAgICAgICAgaWYgKHRyYW5zaXRpb25zLmhhc093blByb3BlcnR5KHQpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGVsLnN0eWxlW3RdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zaXRpb25zW3RdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRoaXMgY2xhc3MgbWFuYWdlcyBhIHNpbmdsZSBpbWFnZS4gSXQga2VlcHMgdHJhY2sgb2YgdGhlIGltYWdlJ3MgaGVpZ2h0LFxuICAgICAqIHdpZHRoLCBhbmQgcG9zaXRpb24gaW4gdGhlIGdyaWQuIEFuIGluc3RhbmNlIG9mIHRoaXMgY2xhc3MgaXMgYXNzb2NpYXRlZFxuICAgICAqIHdpdGggYSBzaW5nbGUgaW1hZ2UgZmlndXJlLCB3aGljaCBsb29rcyBsaWtlIHRoaXM6XG4gICAgICpcbiAgICAgKiAgIDxmaWd1cmUgY2xhc3M9XCJwcm9ncmVzc2l2ZS1pbWFnZVwiXG4gICAgICogICAgICAgZGF0YS1zbWFsbD1cIi4uLlwiXG4gICAgICogICAgICAgZGF0YS1tZWRpdW09XCIuLi5cIlxuICAgICAqICAgICAgIGRhdGEtbGFyZ2U9XCIuLi5cIlxuICAgICAqICAgICAgIGRhdGEtcmF3PVwiLi4uXCI+XG4gICAgICogICAgIDxkaXYgY2xhc3M9XCJhc3BlY3QtcmF0aW8taG9sZGVyXCIgc3R5bGU9XCJwYWRkaW5nLWJvdHRvbTogLi4uXCI+PC9kaXY+XG4gICAgICogICAgIDxpbWcgY2xhc3M9XCJ0aHVtYm5haWxcIiBzcmM9XCIuLi5cIiBhbHQ9XCIuLi5cIj5cbiAgICAgKiAgIDwvZmlndXJlPlxuICAgICAqXG4gICAgICogQHBhcmFtIHtlbGVtZW50fSBmaWd1cmUgLSB0aGUgPGZpZ3VyZT4gRE9NIGVsZW1lbnQuXG4gICAgICogQHJldHVybnMge29iamVjdH0gdGhlIHByb2dyZXNzaXZlIGltYWdlIG9iamVjdFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIFByb2dyZXNzaXZlSW1hZ2UoZmlndXJlKSB7XG4gICAgICAgIHRoaXMuaWQgPSBcInZpZXdlci1cIiArIE1hdGgucm91bmQoTWF0aC5yYW5kb20oKSAqIE1hdGgucG93KDEwLCA2KSkudG9TdHJpbmcoKTtcbiAgICAgICAgdGhpcy52aWV3ZXJPcGVuID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZmlndXJlID0gZmlndXJlO1xuICAgICAgICB0aGlzLnNjcmltID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnc2NyaW0nKVswXTtcbiAgICAgICAgdGhpcy5sYXN0V2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICAgICAgdGhpcy50cmFuc2l0aW9uRW5kRXZlbnQgPSBfd2hpY2hUcmFuc2l0aW9uRW5kRXZlbnQoKTtcbiAgICAgICAgdGhpcy5mb3JjZVNtYWxsID0gKHRoaXMuZmlndXJlLmNsYXNzTmFtZS5pbmRleE9mKCdmb3JjZS1zbWFsbCcpID49IDApO1xuICAgICAgICB0aGlzLmZvcmNlTWVkaXVtID0gKHRoaXMuZmlndXJlLmNsYXNzTmFtZS5pbmRleE9mKCdmb3JjZS1tZWRpdW0nKSA+PSAwKTtcbiAgICAgICAgdGhpcy5mb3JjZUxhcmdlID0gKHRoaXMuZmlndXJlLmNsYXNzTmFtZS5pbmRleE9mKCdmb3JjZS1sYXJnZScpID49IDApO1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSAyNyAvKiBFU0MgKi8gKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbG9zZVZpZXdlcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLmxvYWQoKTtcblxuICAgICAgICBpZiAodGhpcy5maWd1cmUuY2xhc3NOYW1lLmluZGV4T2YoJ3dpdGgtdmlld2VyJykgPj0gMCkge1xuICAgICAgICAgICAgdGhpcy5maWd1cmUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9wZW5WaWV3ZXIuYmluZCh0aGlzKSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBQcm9ncmVzc2l2ZUltYWdlLnByb3RvdHlwZS5jbG9zZVZpZXdlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgdGhpcy5vblNjcm9sbCk7XG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLm9uU2hvdWxkQ2xvc2VWaWV3ZXIpO1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLCB0aGlzLm9uU2hvdWxkQ2xvc2VWaWV3ZXIpO1xuICAgICAgICB0aGlzLnNjcmltLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vblNob3VsZENsb3NlVmlld2VyKTtcblxuICAgICAgICB0aGlzLmZpZ3VyZS5hZGRFdmVudExpc3RlbmVyKHRoaXMudHJhbnNpdGlvbkVuZEV2ZW50LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChkb2N1bWVudC5ib2R5LmNsYXNzTmFtZS5pbmRleE9mKHRoaXMuaWQpID09IC0xKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52aWV3ZXJPcGVuID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdGhpcy5maWd1cmUuY2xhc3NOYW1lID0gdGhpcy5maWd1cmUuY2xhc3NOYW1lXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCdpcy1vcGVuJywgJycpXG4gICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLCAnJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5maWd1cmUuc3R5bGUuekluZGV4ID0gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgLy8gQmVnaW4gdHJhbnNpdGlvblxuICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTmFtZSA9IGRvY3VtZW50LmJvZHkuY2xhc3NOYW1lXG4gICAgICAgICAgICAucmVwbGFjZSh0aGlzLmlkLCAnJylcbiAgICAgICAgICAgIC5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLCAnJyk7XG4gICAgICAgIHRoaXMuZmlndXJlLnN0eWxlLnRyYW5zZm9ybSA9ICcnO1xuICAgIH07XG5cbiAgICBQcm9ncmVzc2l2ZUltYWdlLnByb3RvdHlwZS5vcGVuVmlld2VyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChkb2N1bWVudC5ib2R5LmNsYXNzTmFtZS5pbmRleE9mKHRoaXMuaWQpID49IDApIHtcbiAgICAgICAgICAgIHRoaXMuY2xvc2VWaWV3ZXIoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudmlld2VyT3BlbiA9IHRydWU7XG5cbiAgICAgICAgLy8gSW5pdGlhbCBWYWx1ZXNcbiAgICAgICAgdmFyIGZpZ3VyZVN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUodGhpcy5maWd1cmUpO1xuICAgICAgICB2YXIgaW5pdGlhbEhlaWdodCA9IHBhcnNlRmxvYXQoZmlndXJlU3R5bGUuaGVpZ2h0KTtcbiAgICAgICAgdmFyIGluaXRpYWxXaWR0aCA9IHBhcnNlRmxvYXQoZmlndXJlU3R5bGUud2lkdGgpO1xuICAgICAgICB2YXIgd2luZG93SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuICAgICAgICB2YXIgd2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICAgICAgdmFyIGZpZ3VyZUJvdW5kaW5nUmVjdCA9IHRoaXMuZmlndXJlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgICAgIC8vIENvbXB1dGVkIFZhbHVlc1xuICAgICAgICB2YXIgZmlndXJlQXNwZWN0UmF0aW8gPSBpbml0aWFsV2lkdGggLyBpbml0aWFsSGVpZ2h0O1xuICAgICAgICB2YXIgd2luZG93QXNwZWN0UmF0aW8gPSB3aW5kb3dXaWR0aCAvIHdpbmRvd0hlaWdodDtcbiAgICAgICAgdmFyIHNjYWxlO1xuICAgICAgICB2YXIgdHJhbnNsYXRlWDtcbiAgICAgICAgdmFyIHRyYW5zbGF0ZVk7XG5cbiAgICAgICAgaWYgKHdpbmRvd0FzcGVjdFJhdGlvID49IGZpZ3VyZUFzcGVjdFJhdGlvKSB7XG4gICAgICAgICAgICAvLyBJbWFnZSB3aWxsIGZpbGwgdXAgdmVydGljYWwgc3BhY2VcbiAgICAgICAgICAgIHNjYWxlID0gd2luZG93SGVpZ2h0IC8gaW5pdGlhbEhlaWdodDtcbiAgICAgICAgICAgIHZhciBmaW5hbFdpZHRoID0gaW5pdGlhbFdpZHRoICogc2NhbGU7XG4gICAgICAgICAgICB0cmFuc2xhdGVYID0gKHdpbmRvd1dpZHRoIC0gZmluYWxXaWR0aCkgLyAyIC0gZmlndXJlQm91bmRpbmdSZWN0LmxlZnQ7XG4gICAgICAgICAgICB0cmFuc2xhdGVZID0gZmlndXJlQm91bmRpbmdSZWN0LnRvcCAqIC0xO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBJbWFnZSB3aWxsIGZpbGwgdXAgaG9yaXpvbnRhbCBzcGFjZVxuICAgICAgICAgICAgc2NhbGUgPSB3aW5kb3dXaWR0aCAvIGluaXRpYWxXaWR0aDtcbiAgICAgICAgICAgIHZhciBmaW5hbEhlaWdodCA9IGluaXRpYWxIZWlnaHQgKiBzY2FsZTtcbiAgICAgICAgICAgIHRyYW5zbGF0ZVkgPSAod2luZG93SGVpZ2h0IC0gZmluYWxIZWlnaHQpIC8gMiAtIGZpZ3VyZUJvdW5kaW5nUmVjdC50b3A7XG4gICAgICAgICAgICB0cmFuc2xhdGVYID0gZmlndXJlQm91bmRpbmdSZWN0LmxlZnQgKiAtMTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFwcGx5IERPTSB0cmFuc2Zvcm1hdGlvbnNcbiAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc05hbWUgKz0gJyAnICsgdGhpcy5pZDtcbiAgICAgICAgdGhpcy5maWd1cmUuY2xhc3NOYW1lICs9ICcgaXMtb3Blbic7XG4gICAgICAgIHRoaXMuZmlndXJlLnN0eWxlLnpJbmRleCA9ICc4MDAnO1xuICAgICAgICB0aGlzLmZpZ3VyZS5zdHlsZS50cmFuc2Zvcm0gPSAndHJhbnNsYXRlM2QoJyArIHRyYW5zbGF0ZVggKyAncHgsJyArXG4gICAgICAgICAgICB0cmFuc2xhdGVZICsgJ3B4LDApIHNjYWxlKCcgKyBzY2FsZSArICcpJztcblxuICAgICAgICAvLyBMb2FkIFJhdyBJbWFnZSAobGFyZ2UhKVxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZmlndXJlLmNsYXNzTmFtZS5pbmRleE9mKCdsb2FkZWQtcmF3JykgPD0gMCkge1xuICAgICAgICAgICAgICAgIC8vIFRoZXJlIGlzIGEgbGFyZ2VyIGltYWdlIHRvIGxvYWQuXG4gICAgICAgICAgICAgICAgdGhpcy5sb2FkUmF3KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0uYmluZCh0aGlzKSwgMzAwKTtcblxuICAgICAgICB0aGlzLm9uU2Nyb2xsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgb2Zmc2V0ID0gdGhpcy5maWd1cmUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wO1xuICAgICAgICAgICAgaWYgKE1hdGguYWJzKG9mZnNldCkgPiA1MCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VWaWV3ZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgICAgIHRoaXMub25TaG91bGRDbG9zZVZpZXdlciA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHRoaXMuY2xvc2VWaWV3ZXIoKTtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIH0uYmluZCh0aGlzKTtcblxuICAgICAgICB0aGlzLnNjcmltLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vblNob3VsZENsb3NlVmlld2VyKTtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMub25TaG91bGRDbG9zZVZpZXdlcik7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvcmllbnRhdGlvbmNoYW5nZScsIHRoaXMub25TaG91bGRDbG9zZVZpZXdlcik7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLm9uU2Nyb2xsKTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogTG9hZCB0aGUgZnVsbCBpbWFnZSBlbGVtZW50IGludG8gdGhlIERPTS5cbiAgICAgKi9cbiAgICBQcm9ncmVzc2l2ZUltYWdlLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIENyZWF0ZSBhIG5ldyBpbWFnZSBlbGVtZW50LCBhbmQgaW5zZXJ0IGl0IGludG8gdGhlIERPTS5cbiAgICAgICAgdmFyIGZ1bGxJbWFnZSA9IG5ldyBJbWFnZSgpO1xuICAgICAgICBmdWxsSW1hZ2Uuc3JjID0gdGhpcy5maWd1cmUuZGF0YXNldFt0aGlzLmdldFNpemUoKV07XG4gICAgICAgIGZ1bGxJbWFnZS5jbGFzc05hbWUgPSAnZnVsbCc7XG4gICAgICAgIGZ1bGxJbWFnZS5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuZmlndXJlLmNsYXNzTmFtZSArPSAnIGxvYWRlZCc7XG4gICAgICAgIH0uYmluZCh0aGlzKTtcblxuICAgICAgICB0aGlzLmZpZ3VyZS5hcHBlbmRDaGlsZChmdWxsSW1hZ2UpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBMb2FkIHRoZSByYXcgaW1hZ2UgZWxlbWVudCBpbnRvIHRoZSBET00uXG4gICAgICovXG4gICAgUHJvZ3Jlc3NpdmVJbWFnZS5wcm90b3R5cGUubG9hZFJhdyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAvLyBDcmVhdGUgYSBuZXcgaW1hZ2UgZWxlbWVudCwgYW5kIGluc2VydCBpdCBpbnRvIHRoZSBET00uXG4gICAgICAgIHZhciByYXdJbWFnZSA9IG5ldyBJbWFnZSgpO1xuXG4gICAgICAgIC8vIG5vdCBhY3R1YWxseSByYXcsIGJlY2F1c2UgZGFtbiwgdGhhdCdzIGV4cGVuc2l2ZS5cbiAgICAgICAgcmF3SW1hZ2Uuc3JjID0gdGhpcy5maWd1cmUuZGF0YXNldC5yYXc7XG4gICAgICAgIHJhd0ltYWdlLmNsYXNzTmFtZSA9ICdyYXcnO1xuICAgICAgICByYXdJbWFnZS5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHRoaXMuZmlndXJlLmNsYXNzTmFtZSArPSAnIGxvYWRlZC1yYXcnO1xuICAgICAgICB9LmJpbmQodGhpcyk7XG5cbiAgICAgICAgdGhpcy5maWd1cmUuYXBwZW5kQ2hpbGQocmF3SW1hZ2UpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBDaG9vc2UgdGhlIHNpemUgb2YgaW1hZ2UgdG8gbG9hZCBiYXNlZCBvbiB0aGUgd2luZG93IHdpZHRoLlxuICAgICAqL1xuICAgIFByb2dyZXNzaXZlSW1hZ2UucHJvdG90eXBlLmdldFNpemUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMuZm9yY2VTbWFsbCkge1xuICAgICAgICAgICAgcmV0dXJuICdzbWFsbCc7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5mb3JjZU1lZGl1bSkge1xuICAgICAgICAgICAgcmV0dXJuICdtZWRpdW0nO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuZm9yY2VMYXJnZSkge1xuICAgICAgICAgICAgcmV0dXJuICdsYXJnZSc7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgc2l6ZXMgPSBbJ3NtYWxsJywgJ21lZGl1bScsICdsYXJnZSddO1xuICAgICAgICB2YXIgc2l6ZUluZGV4O1xuICAgICAgICBpZiAodGhpcy5sYXN0V2luZG93V2lkdGggPCA3NjgpIHtcbiAgICAgICAgICAgIHNpemVJbmRleCA9IDA7IC8vIHNtYWxsXG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5sYXN0V2luZG93V2lkdGggPCAxNDQwKSB7XG4gICAgICAgICAgICBzaXplSW5kZXggPSAxOyAvLyBtZWRpdW1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNpemVJbmRleCA9IDI7IC8vIGxhcmdlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUmV0aW5hIGRldmljZXMgc2hvdWxkIGhhdmUgbGFyZ2VyIHBpeGVsIGRlbnNpdGllcy5cbiAgICAgICAgaWYgKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvID4gMSAmJiBzaXplSW5kZXggPCAyKSB7XG4gICAgICAgICAgICBzaXplSW5kZXggKz0gMTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBzaXplc1tzaXplSW5kZXhdO1xuICAgIH07XG5cbiAgICAvLyBFeHBvcnQgUHJvZ3Jlc3NpdmVJbWFnZSBpbnRvIHRoZSBnbG9iYWwgc2NvcGUuXG4gICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgICAgICBkZWZpbmUoUHJvZ3Jlc3NpdmVJbWFnZSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IFByb2dyZXNzaXZlSW1hZ2U7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgZ2xvYmFsLlByb2dyZXNzaXZlSW1hZ2UgPSBQcm9ncmVzc2l2ZUltYWdlO1xuICAgIH1cblxufSh0aGlzKSk7Il0sIm5hbWVzIjpbImdsb2JhbCIsIlByb2dyZXNzaXZlSW1hZ2UiLCJmaWd1cmUiLCJ0aGlzIiwiaWQiLCJNYXRoIiwicm91bmQiLCJyYW5kb20iLCJwb3ciLCJ0b1N0cmluZyIsInZpZXdlck9wZW4iLCJzY3JpbSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImxhc3RXaW5kb3dXaWR0aCIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJ0cmFuc2l0aW9uRW5kRXZlbnQiLCJ0IiwiZWwiLCJjcmVhdGVFbGVtZW50IiwidHJhbnNpdGlvbnMiLCJXZWJraXRUcmFuc2l0aW9uIiwiTW96VHJhbnNpdGlvbiIsIk1TVHJhbnNpdGlvbiIsIk9UcmFuc2l0aW9uIiwidHJhbnNpdGlvbiIsImhhc093blByb3BlcnR5IiwidW5kZWZpbmVkIiwic3R5bGUiLCJfd2hpY2hUcmFuc2l0aW9uRW5kRXZlbnQiLCJmb3JjZVNtYWxsIiwiY2xhc3NOYW1lIiwiaW5kZXhPZiIsImZvcmNlTWVkaXVtIiwiZm9yY2VMYXJnZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwia2V5Q29kZSIsImNsb3NlVmlld2VyIiwiYmluZCIsImxvYWQiLCJvcGVuVmlld2VyIiwicHJvdG90eXBlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIm9uU2Nyb2xsIiwib25TaG91bGRDbG9zZVZpZXdlciIsImJvZHkiLCJyZXBsYWNlIiwiekluZGV4IiwidHJhbnNmb3JtIiwiaW5pdGlhbEhlaWdodCIsImluaXRpYWxXaWR0aCIsIndpbmRvd0hlaWdodCIsIndpbmRvd1dpZHRoIiwiZmlndXJlQm91bmRpbmdSZWN0Iiwic2NhbGUiLCJ0cmFuc2xhdGVYIiwidHJhbnNsYXRlWSIsImZpZ3VyZVN0eWxlIiwiZ2V0Q29tcHV0ZWRTdHlsZSIsInBhcnNlRmxvYXQiLCJoZWlnaHQiLCJ3aWR0aCIsImlubmVySGVpZ2h0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwibGVmdCIsInRvcCIsInNldFRpbWVvdXQiLCJsb2FkUmF3Iiwib2Zmc2V0IiwiYWJzIiwic3RvcFByb3BhZ2F0aW9uIiwiZnVsbEltYWdlIiwiSW1hZ2UiLCJzcmMiLCJkYXRhc2V0IiwiZ2V0U2l6ZSIsIm9ubG9hZCIsImFwcGVuZENoaWxkIiwicmF3SW1hZ2UiLCJyYXciLCJzaXplSW5kZXgiLCJkZXZpY2VQaXhlbFJhdGlvIiwiZGVmaW5lIiwiYW1kIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkNBQUMsU0FBU0EsZ0JBNENOLFNBQVNDLEVBQWlCQyxHQXFCdEIsT0FwQkFDLEtBQUtDLEdBQUssVUFBWUMsS0FBS0MsTUFBTUQsS0FBS0UsU0FBV0YsS0FBS0csSUFBSSxHQUFJLElBQUlDLFdBQ2xFTixLQUFLTyxZQUFhLEVBQ2xCUCxLQUFLRCxPQUFTQSxFQUNkQyxLQUFLUSxNQUFRQyxT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
