!function(e){"use strict";function i(){var e,i=document.createElement("fakeelement"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",MSTransition:"msTransitionEnd",OTransition:"otransitionend",transition:"transitionend"};for(e in t)if(t.hasOwnProperty(e)&&void 0!==i.style[e])return t[e]}function t(e){return this.id="viewer-"+Math.round(Math.random()*Math.pow(10,6)).toString(),this.viewerOpen=!1,this.figure=e,this.scrim=document.getElementsByClassName("scrim")[0],this.lastWindowWidth=window.innerWidth,this.transitionEndEvent=i(),this.forceSmall=this.figure.className.indexOf("force-small")>=0,this.forceMedium=this.figure.className.indexOf("force-medium")>=0,this.forceLarge=this.figure.className.indexOf("force-large")>=0,window.addEventListener("keyup",function(e){27===e.keyCode&&this.closeViewer()}.bind(this)),this.load(),this.figure.className.indexOf("with-viewer")>=0&&this.figure.addEventListener("click",this.openViewer.bind(this)),this}t.prototype.closeViewer=function(){window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onShouldCloseViewer),window.removeEventListener("orientationchange",this.onShouldCloseViewer),this.scrim.removeEventListener("click",this.onShouldCloseViewer),this.figure.addEventListener(this.transitionEndEvent,function(){document.body.className.indexOf(this.id)==-1&&(this.viewerOpen=!1,this.figure.className=this.figure.className.replace("is-open","").replace(/^\s+|\s+$/g,""),this.figure.style.zIndex="")}.bind(this)),document.body.className=document.body.className.replace(this.id,"").replace(/^\s+|\s+$/g,""),this.figure.style.transform=""},t.prototype.openViewer=function(){if(document.body.className.indexOf(this.id)>=0)return void this.closeViewer();this.viewerOpen=!0;var e,i,t,s=window.getComputedStyle(this.figure),n=parseFloat(s.height),o=parseFloat(s.width),r=window.innerHeight,a=window.innerWidth,d=this.figure.getBoundingClientRect(),l=o/n,h=a/r;if(h>=l){e=r/n;var c=o*e;i=(a-c)/2-d.left,t=d.top*-1}else{e=a/o;var u=n*e;t=(r-u)/2-d.top,i=d.left*-1}document.body.className+=" "+this.id,this.figure.className+=" is-open",this.figure.style.zIndex="800",this.figure.style.transform="translate3d("+i+"px,"+t+"px,0) scale("+e+")",setTimeout(function(){this.figure.className.indexOf("loaded-raw")<=0&&this.loadRaw()}.bind(this),300),this.onScroll=function(){var e=this.figure.getBoundingClientRect().top;Math.abs(e)>50&&this.closeViewer()}.bind(this),this.onShouldCloseViewer=function(e){this.closeViewer(),e.stopPropagation()}.bind(this),this.scrim.addEventListener("click",this.onShouldCloseViewer),window.addEventListener("resize",this.onShouldCloseViewer),window.addEventListener("orientationchange",this.onShouldCloseViewer),window.addEventListener("scroll",this.onScroll)},t.prototype.load=function(){var e=new Image;e.src=this.figure.dataset[this.getSize()],e.className="full",e.onload=function(){this.figure.className+=" loaded"}.bind(this),this.figure.appendChild(e)},t.prototype.loadRaw=function(){var e=new Image;e.src=this.figure.dataset.raw,e.className="raw",e.onload=function(){this.figure.className+=" loaded-raw"}.bind(this),this.figure.appendChild(e)},t.prototype.getSize=function(){if(this.forceSmall)return"small";if(this.forceMedium)return"medium";if(this.forceLarge)return"large";var e,i=["small","medium","large"];return e=this.lastWindowWidth<768?0:this.lastWindowWidth<1440?1:2,window.devicePixelRatio>1&&e<2&&(e+=1),i[e]},"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&module.exports?module.exports=t:e.ProgressiveImage=t}(this);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb2dyZXNzaXZlLWltYWdlLmpzIl0sIm5hbWVzIjpbImdsb2JhbCIsIl93aGljaFRyYW5zaXRpb25FbmRFdmVudCIsInQiLCJlbCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInRyYW5zaXRpb25zIiwiV2Via2l0VHJhbnNpdGlvbiIsIk1velRyYW5zaXRpb24iLCJNU1RyYW5zaXRpb24iLCJPVHJhbnNpdGlvbiIsInRyYW5zaXRpb24iLCJoYXNPd25Qcm9wZXJ0eSIsInVuZGVmaW5lZCIsInN0eWxlIiwiUHJvZ3Jlc3NpdmVJbWFnZSIsImZpZ3VyZSIsInRoaXMiLCJpZCIsIk1hdGgiLCJyb3VuZCIsInJhbmRvbSIsInBvdyIsInRvU3RyaW5nIiwidmlld2VyT3BlbiIsInNjcmltIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImxhc3RXaW5kb3dXaWR0aCIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJ0cmFuc2l0aW9uRW5kRXZlbnQiLCJmb3JjZVNtYWxsIiwiY2xhc3NOYW1lIiwiaW5kZXhPZiIsImZvcmNlTWVkaXVtIiwiZm9yY2VMYXJnZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwia2V5Q29kZSIsImNsb3NlVmlld2VyIiwiYmluZCIsImxvYWQiLCJvcGVuVmlld2VyIiwicHJvdG90eXBlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIm9uU2Nyb2xsIiwib25TaG91bGRDbG9zZVZpZXdlciIsImJvZHkiLCJyZXBsYWNlIiwiekluZGV4IiwidHJhbnNmb3JtIiwic2NhbGUiLCJ0cmFuc2xhdGVYIiwidHJhbnNsYXRlWSIsImZpZ3VyZVN0eWxlIiwiZ2V0Q29tcHV0ZWRTdHlsZSIsImluaXRpYWxIZWlnaHQiLCJwYXJzZUZsb2F0IiwiaGVpZ2h0IiwiaW5pdGlhbFdpZHRoIiwid2lkdGgiLCJ3aW5kb3dIZWlnaHQiLCJpbm5lckhlaWdodCIsIndpbmRvd1dpZHRoIiwiZmlndXJlQm91bmRpbmdSZWN0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwiZmlndXJlQXNwZWN0UmF0aW8iLCJ3aW5kb3dBc3BlY3RSYXRpbyIsImZpbmFsV2lkdGgiLCJsZWZ0IiwidG9wIiwiZmluYWxIZWlnaHQiLCJzZXRUaW1lb3V0IiwibG9hZFJhdyIsIm9mZnNldCIsImFicyIsInN0b3BQcm9wYWdhdGlvbiIsImZ1bGxJbWFnZSIsIkltYWdlIiwic3JjIiwiZGF0YXNldCIsImdldFNpemUiLCJvbmxvYWQiLCJhcHBlbmRDaGlsZCIsInJhd0ltYWdlIiwicmF3Iiwic2l6ZUluZGV4Iiwic2l6ZXMiLCJkZXZpY2VQaXhlbFJhdGlvIiwiZGVmaW5lIiwiYW1kIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkNBQUMsU0FBVUEsR0FDVCxZQU9BLFNBQVNDLEtBQ1AsR0FBSUMsR0FDQUMsRUFBS0MsU0FBU0MsY0FBYyxlQUM1QkMsR0FDRkMsaUJBQWtCLHNCQUNsQkMsY0FBZSxnQkFDZkMsYUFBYyxrQkFDZEMsWUFBYSxpQkFDYkMsV0FBWSxnQkFFZCxLQUFLVCxJQUFLSSxHQUNSLEdBQUlBLEVBQVlNLGVBQWVWLElBQ1RXLFNBQWhCVixFQUFHVyxNQUFNWixHQUNYLE1BQU9JLEdBQVlKLEdBdUIzQixRQUFTYSxHQUFpQkMsR0FxQnhCLE1BcEJBQyxNQUFLQyxHQUFLLFVBQVlDLEtBQUtDLE1BQU1ELEtBQUtFLFNBQVNGLEtBQUtHLElBQUksR0FBRyxJQUFJQyxXQUMvRE4sS0FBS08sWUFBYSxFQUNsQlAsS0FBS0QsT0FBU0EsRUFDZEMsS0FBS1EsTUFBUXJCLFNBQVNzQix1QkFBdUIsU0FBUyxHQUN0RFQsS0FBS1UsZ0JBQWtCQyxPQUFPQyxXQUM5QlosS0FBS2EsbUJBQXFCN0IsSUFDMUJnQixLQUFLYyxXQUFjZCxLQUFLRCxPQUFPZ0IsVUFBVUMsUUFBUSxnQkFBa0IsRUFDbkVoQixLQUFLaUIsWUFBZWpCLEtBQUtELE9BQU9nQixVQUFVQyxRQUFRLGlCQUFtQixFQUNyRWhCLEtBQUtrQixXQUFjbEIsS0FBS0QsT0FBT2dCLFVBQVVDLFFBQVEsZ0JBQWtC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clxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIC8qKlxyXG4gICAqIEZpbmQgdGhlIENTUyB0cmFuc2l0aW9uIGVuZCBldmVudCB0aGF0IHdlIHNob3VsZCBsaXN0ZW4gZm9yLlxyXG4gICAqXHJcbiAgICogQHJldHVybnMge3N0cmluZ30gdCAtIHRoZSB0cmFuc2l0aW9uIHN0cmluZ1xyXG4gICAqL1xyXG4gIGZ1bmN0aW9uIF93aGljaFRyYW5zaXRpb25FbmRFdmVudCgpIHtcclxuICAgIHZhciB0O1xyXG4gICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZmFrZWVsZW1lbnQnKTtcclxuICAgIHZhciB0cmFuc2l0aW9ucyA9IHtcclxuICAgICAgV2Via2l0VHJhbnNpdGlvbjogJ3dlYmtpdFRyYW5zaXRpb25FbmQnLFxyXG4gICAgICBNb3pUcmFuc2l0aW9uOiAndHJhbnNpdGlvbmVuZCcsXHJcbiAgICAgIE1TVHJhbnNpdGlvbjogJ21zVHJhbnNpdGlvbkVuZCcsXHJcbiAgICAgIE9UcmFuc2l0aW9uOiAnb3RyYW5zaXRpb25lbmQnLFxyXG4gICAgICB0cmFuc2l0aW9uOiAndHJhbnNpdGlvbmVuZCcsXHJcbiAgICB9O1xyXG4gICAgZm9yICh0IGluIHRyYW5zaXRpb25zKSB7XHJcbiAgICAgIGlmICh0cmFuc2l0aW9ucy5oYXNPd25Qcm9wZXJ0eSh0KSkge1xyXG4gICAgICAgIGlmIChlbC5zdHlsZVt0XSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICByZXR1cm4gdHJhbnNpdGlvbnNbdF07XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBUaGlzIGNsYXNzIG1hbmFnZXMgYSBzaW5nbGUgaW1hZ2UuIEl0IGtlZXBzIHRyYWNrIG9mIHRoZSBpbWFnZSdzIGhlaWdodCxcclxuICAgKiB3aWR0aCwgYW5kIHBvc2l0aW9uIGluIHRoZSBncmlkLiBBbiBpbnN0YW5jZSBvZiB0aGlzIGNsYXNzIGlzIGFzc29jaWF0ZWRcclxuICAgKiB3aXRoIGEgc2luZ2xlIGltYWdlIGZpZ3VyZSwgd2hpY2ggbG9va3MgbGlrZSB0aGlzOlxyXG4gICAqXHJcbiAgICogICA8ZmlndXJlIGNsYXNzPVwicHJvZ3Jlc3NpdmUtaW1hZ2VcIlxyXG4gICAqICAgICAgIGRhdGEtc21hbGw9XCIuLi5cIlxyXG4gICAqICAgICAgIGRhdGEtbWVkaXVtPVwiLi4uXCJcclxuICAgKiAgICAgICBkYXRhLWxhcmdlPVwiLi4uXCJcclxuICAgKiAgICAgICBkYXRhLXJhdz1cIi4uLlwiPlxyXG4gICAqICAgICA8ZGl2IGNsYXNzPVwiYXNwZWN0LXJhdGlvLWhvbGRlclwiIHN0eWxlPVwicGFkZGluZy1ib3R0b206IC4uLlwiPjwvZGl2PlxyXG4gICAqICAgICA8aW1nIGNsYXNzPVwidGh1bWJuYWlsXCIgc3JjPVwiLi4uXCIgYWx0PVwiLi4uXCI+XHJcbiAgICogICA8L2ZpZ3VyZT5cclxuICAgKlxyXG4gICAqIEBwYXJhbSB7ZWxlbWVudH0gZmlndXJlIC0gdGhlIDxmaWd1cmU+IERPTSBlbGVtZW50LlxyXG4gICAqIEByZXR1cm5zIHtvYmplY3R9IHRoZSBwcm9ncmVzc2l2ZSBpbWFnZSBvYmplY3RcclxuICAgKi9cclxuICBmdW5jdGlvbiBQcm9ncmVzc2l2ZUltYWdlKGZpZ3VyZSkge1xyXG4gICAgdGhpcy5pZCA9IFwidmlld2VyLVwiICsgTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpKk1hdGgucG93KDEwLDYpKS50b1N0cmluZygpO1xyXG4gICAgdGhpcy52aWV3ZXJPcGVuID0gZmFsc2U7XHJcbiAgICB0aGlzLmZpZ3VyZSA9IGZpZ3VyZTtcclxuICAgIHRoaXMuc2NyaW0gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdzY3JpbScpWzBdO1xyXG4gICAgdGhpcy5sYXN0V2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuICAgIHRoaXMudHJhbnNpdGlvbkVuZEV2ZW50ID0gX3doaWNoVHJhbnNpdGlvbkVuZEV2ZW50KCk7XHJcbiAgICB0aGlzLmZvcmNlU21hbGwgPSAodGhpcy5maWd1cmUuY2xhc3NOYW1lLmluZGV4T2YoJ2ZvcmNlLXNtYWxsJykgPj0gMCk7XHJcbiAgICB0aGlzLmZvcmNlTWVkaXVtID0gKHRoaXMuZmlndXJlLmNsYXNzTmFtZS5pbmRleE9mKCdmb3JjZS1tZWRpdW0nKSA+PSAwKTtcclxuICAgIHRoaXMuZm9yY2VMYXJnZSA9ICh0aGlzLmZpZ3VyZS5jbGFzc05hbWUuaW5kZXhPZignZm9yY2UtbGFyZ2UnKSA+PSAwKTtcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMjcgLyogRVNDICovKSB7XHJcbiAgICAgICAgdGhpcy5jbG9zZVZpZXdlcigpO1xyXG4gICAgICB9XHJcbiAgICB9LmJpbmQodGhpcykpO1xyXG4gICAgdGhpcy5sb2FkKCk7XHJcblxyXG4gICAgaWYgKHRoaXMuZmlndXJlLmNsYXNzTmFtZS5pbmRleE9mKCd3aXRoLXZpZXdlcicpID49IDApIHtcclxuICAgICAgdGhpcy5maWd1cmUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9wZW5WaWV3ZXIuYmluZCh0aGlzKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICBQcm9ncmVzc2l2ZUltYWdlLnByb3RvdHlwZS5jbG9zZVZpZXdlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLm9uU2Nyb2xsKTtcclxuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLm9uU2hvdWxkQ2xvc2VWaWV3ZXIpO1xyXG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ29yaWVudGF0aW9uY2hhbmdlJywgdGhpcy5vblNob3VsZENsb3NlVmlld2VyKTtcclxuICAgIHRoaXMuc2NyaW0ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uU2hvdWxkQ2xvc2VWaWV3ZXIpO1xyXG5cclxuICAgIHRoaXMuZmlndXJlLmFkZEV2ZW50TGlzdGVuZXIodGhpcy50cmFuc2l0aW9uRW5kRXZlbnQsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgaWYgKGRvY3VtZW50LmJvZHkuY2xhc3NOYW1lLmluZGV4T2YodGhpcy5pZCkgPT0gLTEpIHtcclxuICAgICAgICB0aGlzLnZpZXdlck9wZW4gPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmZpZ3VyZS5jbGFzc05hbWUgPSB0aGlzLmZpZ3VyZS5jbGFzc05hbWVcclxuICAgICAgICAgIC5yZXBsYWNlKCdpcy1vcGVuJywgJycpXHJcbiAgICAgICAgICAucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgJycpO1xyXG4gICAgICAgIHRoaXMuZmlndXJlLnN0eWxlLnpJbmRleCA9ICcnO1xyXG4gICAgICB9XHJcbiAgICB9LmJpbmQodGhpcykpO1xyXG5cclxuICAgIC8vIEJlZ2luIHRyYW5zaXRpb25cclxuICAgIGRvY3VtZW50LmJvZHkuY2xhc3NOYW1lID0gZG9jdW1lbnQuYm9keS5jbGFzc05hbWVcclxuICAgICAgLnJlcGxhY2UodGhpcy5pZCwgJycpXHJcbiAgICAgIC5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLCAnJyk7XHJcbiAgICB0aGlzLmZpZ3VyZS5zdHlsZS50cmFuc2Zvcm0gPSAnJztcclxuICB9O1xyXG5cclxuICBQcm9ncmVzc2l2ZUltYWdlLnByb3RvdHlwZS5vcGVuVmlld2VyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgaWYgKGRvY3VtZW50LmJvZHkuY2xhc3NOYW1lLmluZGV4T2YodGhpcy5pZCkgPj0gMCkge1xyXG4gICAgICB0aGlzLmNsb3NlVmlld2VyKCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnZpZXdlck9wZW4gPSB0cnVlO1xyXG5cclxuICAgIC8vIEluaXRpYWwgVmFsdWVzXHJcbiAgICB2YXIgZmlndXJlU3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLmZpZ3VyZSk7XHJcbiAgICB2YXIgaW5pdGlhbEhlaWdodCA9IHBhcnNlRmxvYXQoZmlndXJlU3R5bGUuaGVpZ2h0KTtcclxuICAgIHZhciBpbml0aWFsV2lkdGggPSBwYXJzZUZsb2F0KGZpZ3VyZVN0eWxlLndpZHRoKTtcclxuICAgIHZhciB3aW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbiAgICB2YXIgd2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuICAgIHZhciBmaWd1cmVCb3VuZGluZ1JlY3QgPSB0aGlzLmZpZ3VyZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuXHJcbiAgICAvLyBDb21wdXRlZCBWYWx1ZXNcclxuICAgIHZhciBmaWd1cmVBc3BlY3RSYXRpbyA9IGluaXRpYWxXaWR0aCAvIGluaXRpYWxIZWlnaHQ7XHJcbiAgICB2YXIgd2luZG93QXNwZWN0UmF0aW8gPSB3aW5kb3dXaWR0aCAvIHdpbmRvd0hlaWdodDtcclxuICAgIHZhciBzY2FsZTtcclxuICAgIHZhciB0cmFuc2xhdGVYO1xyXG4gICAgdmFyIHRyYW5zbGF0ZVk7XHJcblxyXG4gICAgaWYgKHdpbmRvd0FzcGVjdFJhdGlvID49IGZpZ3VyZUFzcGVjdFJhdGlvKSB7XHJcbiAgICAgIC8vIEltYWdlIHdpbGwgZmlsbCB1cCB2ZXJ0aWNhbCBzcGFjZVxyXG4gICAgICBzY2FsZSA9IHdpbmRvd0hlaWdodCAvIGluaXRpYWxIZWlnaHQ7XHJcbiAgICAgIHZhciBmaW5hbFdpZHRoID0gaW5pdGlhbFdpZHRoICogc2NhbGU7XHJcbiAgICAgIHRyYW5zbGF0ZVggPSAod2luZG93V2lkdGggLSBmaW5hbFdpZHRoKSAvIDIgLSBmaWd1cmVCb3VuZGluZ1JlY3QubGVmdDtcclxuICAgICAgdHJhbnNsYXRlWSA9IGZpZ3VyZUJvdW5kaW5nUmVjdC50b3AgKiAtMTtcclxuXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyBJbWFnZSB3aWxsIGZpbGwgdXAgaG9yaXpvbnRhbCBzcGFjZVxyXG4gICAgICBzY2FsZSA9IHdpbmRvd1dpZHRoIC8gaW5pdGlhbFdpZHRoO1xyXG4gICAgICB2YXIgZmluYWxIZWlnaHQgPSBpbml0aWFsSGVpZ2h0ICogc2NhbGU7XHJcbiAgICAgIHRyYW5zbGF0ZVkgPSAod2luZG93SGVpZ2h0IC0gZmluYWxIZWlnaHQpIC8gMiAtIGZpZ3VyZUJvdW5kaW5nUmVjdC50b3A7XHJcbiAgICAgIHRyYW5zbGF0ZVggPSBmaWd1cmVCb3VuZGluZ1JlY3QubGVmdCAqIC0xO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEFwcGx5IERPTSB0cmFuc2Zvcm1hdGlvbnNcclxuICAgIGRvY3VtZW50LmJvZHkuY2xhc3NOYW1lICs9ICcgJyArIHRoaXMuaWQ7XHJcbiAgICB0aGlzLmZpZ3VyZS5jbGFzc05hbWUgKz0gJyBpcy1vcGVuJztcclxuICAgIHRoaXMuZmlndXJlLnN0eWxlLnpJbmRleCA9ICc4MDAnO1xyXG4gICAgdGhpcy5maWd1cmUuc3R5bGUudHJhbnNmb3JtID0gJ3RyYW5zbGF0ZTNkKCcgKyB0cmFuc2xhdGVYICsgJ3B4LCcgK1xyXG4gICAgICB0cmFuc2xhdGVZICsgJ3B4LDApIHNjYWxlKCcgKyBzY2FsZSArICcpJztcclxuXHJcbiAgICAvLyBMb2FkIFJhdyBJbWFnZSAobGFyZ2UhKVxyXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGlmICh0aGlzLmZpZ3VyZS5jbGFzc05hbWUuaW5kZXhPZignbG9hZGVkLXJhdycpIDw9IDApIHtcclxuICAgICAgICAvLyBUaGVyZSBpcyBhIGxhcmdlciBpbWFnZSB0byBsb2FkLlxyXG4gICAgICAgIHRoaXMubG9hZFJhdygpO1xyXG4gICAgICB9XHJcbiAgICB9LmJpbmQodGhpcyksIDMwMCk7XHJcblxyXG4gICAgdGhpcy5vblNjcm9sbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgdmFyIG9mZnNldCA9IHRoaXMuZmlndXJlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcclxuICAgICAgaWYgKE1hdGguYWJzKG9mZnNldCkgPiA1MCkge1xyXG4gICAgICAgIHRoaXMuY2xvc2VWaWV3ZXIoKTtcclxuICAgICAgfVxyXG4gICAgfS5iaW5kKHRoaXMpO1xyXG5cclxuICAgIHRoaXMub25TaG91bGRDbG9zZVZpZXdlciA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgIHRoaXMuY2xvc2VWaWV3ZXIoKTtcclxuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgIH0uYmluZCh0aGlzKTtcclxuXHJcbiAgICB0aGlzLnNjcmltLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vblNob3VsZENsb3NlVmlld2VyKTtcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLm9uU2hvdWxkQ2xvc2VWaWV3ZXIpO1xyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29yaWVudGF0aW9uY2hhbmdlJywgdGhpcy5vblNob3VsZENsb3NlVmlld2VyKTtcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLm9uU2Nyb2xsKTtcclxuICB9O1xyXG5cclxuICAvKipcclxuICAgKiBMb2FkIHRoZSBmdWxsIGltYWdlIGVsZW1lbnQgaW50byB0aGUgRE9NLlxyXG4gICAqL1xyXG4gIFByb2dyZXNzaXZlSW1hZ2UucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAvLyBDcmVhdGUgYSBuZXcgaW1hZ2UgZWxlbWVudCwgYW5kIGluc2VydCBpdCBpbnRvIHRoZSBET00uXHJcbiAgICB2YXIgZnVsbEltYWdlID0gbmV3IEltYWdlKCk7XHJcbiAgICBmdWxsSW1hZ2Uuc3JjID0gdGhpcy5maWd1cmUuZGF0YXNldFt0aGlzLmdldFNpemUoKV07XHJcbiAgICBmdWxsSW1hZ2UuY2xhc3NOYW1lID0gJ2Z1bGwnO1xyXG4gICAgZnVsbEltYWdlLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgdGhpcy5maWd1cmUuY2xhc3NOYW1lICs9ICcgbG9hZGVkJztcclxuICAgIH0uYmluZCh0aGlzKTtcclxuXHJcbiAgICB0aGlzLmZpZ3VyZS5hcHBlbmRDaGlsZChmdWxsSW1hZ2UpO1xyXG4gIH07XHJcblxyXG4gIC8qKlxyXG4gICAqIExvYWQgdGhlIHJhdyBpbWFnZSBlbGVtZW50IGludG8gdGhlIERPTS5cclxuICAgKi9cclxuICBQcm9ncmVzc2l2ZUltYWdlLnByb3RvdHlwZS5sb2FkUmF3ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgLy8gQ3JlYXRlIGEgbmV3IGltYWdlIGVsZW1lbnQsIGFuZCBpbnNlcnQgaXQgaW50byB0aGUgRE9NLlxyXG4gICAgdmFyIHJhd0ltYWdlID0gbmV3IEltYWdlKCk7XHJcblxyXG4gICAgLy8gbm90IGFjdHVhbGx5IHJhdywgYmVjYXVzZSBkYW1uLCB0aGF0J3MgZXhwZW5zaXZlLlxyXG4gICAgcmF3SW1hZ2Uuc3JjID0gdGhpcy5maWd1cmUuZGF0YXNldC5yYXc7XHJcbiAgICByYXdJbWFnZS5jbGFzc05hbWUgPSAncmF3JztcclxuICAgIHJhd0ltYWdlLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgdGhpcy5maWd1cmUuY2xhc3NOYW1lICs9ICcgbG9hZGVkLXJhdyc7XHJcbiAgICB9LmJpbmQodGhpcyk7XHJcblxyXG4gICAgdGhpcy5maWd1cmUuYXBwZW5kQ2hpbGQocmF3SW1hZ2UpO1xyXG4gIH07XHJcblxyXG4gIC8qKlxyXG4gICAqIENob29zZSB0aGUgc2l6ZSBvZiBpbWFnZSB0byBsb2FkIGJhc2VkIG9uIHRoZSB3aW5kb3cgd2lkdGguXHJcbiAgICovXHJcbiAgUHJvZ3Jlc3NpdmVJbWFnZS5wcm90b3R5cGUuZ2V0U2l6ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgIGlmICh0aGlzLmZvcmNlU21hbGwpIHtcclxuICAgICAgcmV0dXJuICdzbWFsbCc7XHJcbiAgICB9IGVsc2UgaWYgKHRoaXMuZm9yY2VNZWRpdW0pIHtcclxuICAgICAgcmV0dXJuICdtZWRpdW0nO1xyXG4gICAgfSBlbHNlIGlmICh0aGlzLmZvcmNlTGFyZ2UpIHtcclxuICAgICAgcmV0dXJuICdsYXJnZSc7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHNpemVzID0gWydzbWFsbCcsICdtZWRpdW0nLCAnbGFyZ2UnXTtcclxuICAgIHZhciBzaXplSW5kZXg7XHJcbiAgICBpZiAodGhpcy5sYXN0V2luZG93V2lkdGggPCA3NjgpIHtcclxuICAgICAgc2l6ZUluZGV4ID0gMDsgLy8gc21hbGxcclxuICAgIH0gZWxzZSBpZiAodGhpcy5sYXN0V2luZG93V2lkdGggPCAxNDQwKSB7XHJcbiAgICAgIHNpemVJbmRleCA9IDE7IC8vIG1lZGl1bVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2l6ZUluZGV4ID0gMjsgLy8gbGFyZ2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUmV0aW5hIGRldmljZXMgc2hvdWxkIGhhdmUgbGFyZ2VyIHBpeGVsIGRlbnNpdGllcy5cclxuICAgIGlmICh3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyA+IDEgJiYgc2l6ZUluZGV4IDwgMikge1xyXG4gICAgICBzaXplSW5kZXggKz0gMTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gc2l6ZXNbc2l6ZUluZGV4XTtcclxuICB9O1xyXG5cclxuICAvLyBFeHBvcnQgUHJvZ3Jlc3NpdmVJbWFnZSBpbnRvIHRoZSBnbG9iYWwgc2NvcGUuXHJcbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xyXG4gICAgZGVmaW5lKFByb2dyZXNzaXZlSW1hZ2UpO1xyXG4gIH0gZWxzZSBpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHtcclxuICAgIG1vZHVsZS5leHBvcnRzID0gUHJvZ3Jlc3NpdmVJbWFnZTtcclxuICB9IGVsc2Uge1xyXG4gICAgZ2xvYmFsLlByb2dyZXNzaXZlSW1hZ2UgPSBQcm9ncmVzc2l2ZUltYWdlO1xyXG4gIH1cclxuXHJcbn0odGhpcykpO1xyXG4iXX0=
