!function(e){"use strict";function i(){var e,i=document.createElement("fakeelement"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",MSTransition:"msTransitionEnd",OTransition:"otransitionend",transition:"transitionend"};for(e in t)if(t.hasOwnProperty(e)&&void 0!==i.style[e])return t[e]}function t(e){return this.id="viewer-"+Math.round(Math.random()*Math.pow(10,6)).toString(),this.viewerOpen=!1,this.figure=e,this.scrim=document.getElementsByClassName("scrim")[0],this.lastWindowWidth=window.innerWidth,this.transitionEndEvent=i(),this.forceSmall=this.figure.className.indexOf("force-small")>=0,this.forceMedium=this.figure.className.indexOf("force-medium")>=0,this.forceLarge=this.figure.className.indexOf("force-large")>=0,window.addEventListener("keyup",function(e){27===e.keyCode&&this.closeViewer()}.bind(this)),this.load(),this.figure.className.indexOf("with-viewer")>=0&&this.figure.addEventListener("click",this.openViewer.bind(this)),this}t.prototype.closeViewer=function(){window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onShouldCloseViewer),window.removeEventListener("orientationchange",this.onShouldCloseViewer),this.scrim.removeEventListener("click",this.onShouldCloseViewer),this.figure.addEventListener(this.transitionEndEvent,function(){document.body.className.indexOf(this.id)==-1&&(this.viewerOpen=!1,this.figure.className=this.figure.className.replace("is-open","").replace(/^\s+|\s+$/g,""),this.figure.style.zIndex="")}.bind(this)),document.body.className=document.body.className.replace(this.id,"").replace(/^\s+|\s+$/g,""),this.figure.style.transform=""},t.prototype.openViewer=function(){if(document.body.className.indexOf(this.id)>=0)return void this.closeViewer();this.viewerOpen=!0;var e,i,t,s=window.getComputedStyle(this.figure),n=parseFloat(s.height),o=parseFloat(s.width),r=window.innerHeight,a=window.innerWidth,d=this.figure.getBoundingClientRect(),l=o/n,h=a/r;if(h>=l){e=r/n;var c=o*e;i=(a-c)/2-d.left,t=d.top*-1}else{e=a/o;var u=n*e;t=(r-u)/2-d.top,i=d.left*-1}document.body.className+=" "+this.id,this.figure.className+=" is-open",this.figure.style.zIndex="800",this.figure.style.transform="translate3d("+i+"px,"+t+"px,0) scale("+e+")",setTimeout(function(){this.figure.className.indexOf("loaded-raw")<=0&&this.loadRaw()}.bind(this),300),this.onScroll=function(){var e=this.figure.getBoundingClientRect().top;Math.abs(e)>50&&this.closeViewer()}.bind(this),this.onShouldCloseViewer=function(e){this.closeViewer(),e.stopPropagation()}.bind(this),this.scrim.addEventListener("click",this.onShouldCloseViewer),window.addEventListener("resize",this.onShouldCloseViewer),window.addEventListener("orientationchange",this.onShouldCloseViewer),window.addEventListener("scroll",this.onScroll)},t.prototype.load=function(){var e=new Image;e.src=this.figure.dataset[this.getSize()],e.className="full",e.onload=function(){this.figure.className+=" loaded"}.bind(this),this.figure.appendChild(e)},t.prototype.loadRaw=function(){var e=new Image;e.src=this.figure.dataset.raw,e.className="raw",e.onload=function(){this.figure.className+=" loaded-raw"}.bind(this),this.figure.appendChild(e)},t.prototype.getSize=function(){if(this.forceSmall)return"small";if(this.forceMedium)return"medium";if(this.forceLarge)return"large";var e,i=["small","medium","large"];return e=this.lastWindowWidth<768?0:this.lastWindowWidth<1440?1:2,window.devicePixelRatio>1&&e<2&&(e+=1),i[e]},"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&module.exports?module.exports=t:e.ProgressiveImage=t}(this);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb2dyZXNzaXZlLWltYWdlLmpzIl0sIm5hbWVzIjpbImdsb2JhbCIsIl93aGljaFRyYW5zaXRpb25FbmRFdmVudCIsInQiLCJlbCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInRyYW5zaXRpb25zIiwiV2Via2l0VHJhbnNpdGlvbiIsIk1velRyYW5zaXRpb24iLCJNU1RyYW5zaXRpb24iLCJPVHJhbnNpdGlvbiIsInRyYW5zaXRpb24iLCJoYXNPd25Qcm9wZXJ0eSIsInVuZGVmaW5lZCIsInN0eWxlIiwiUHJvZ3Jlc3NpdmVJbWFnZSIsImZpZ3VyZSIsInRoaXMiLCJpZCIsIk1hdGgiLCJyb3VuZCIsInJhbmRvbSIsInBvdyIsInRvU3RyaW5nIiwidmlld2VyT3BlbiIsInNjcmltIiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImxhc3RXaW5kb3dXaWR0aCIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJ0cmFuc2l0aW9uRW5kRXZlbnQiLCJmb3JjZVNtYWxsIiwiY2xhc3NOYW1lIiwiaW5kZXhPZiIsImZvcmNlTWVkaXVtIiwiZm9yY2VMYXJnZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwia2V5Q29kZSIsImNsb3NlVmlld2VyIiwiYmluZCIsImxvYWQiLCJvcGVuVmlld2VyIiwicHJvdG90eXBlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsIm9uU2Nyb2xsIiwib25TaG91bGRDbG9zZVZpZXdlciIsImJvZHkiLCJyZXBsYWNlIiwiekluZGV4IiwidHJhbnNmb3JtIiwic2NhbGUiLCJ0cmFuc2xhdGVYIiwidHJhbnNsYXRlWSIsImZpZ3VyZVN0eWxlIiwiZ2V0Q29tcHV0ZWRTdHlsZSIsImluaXRpYWxIZWlnaHQiLCJwYXJzZUZsb2F0IiwiaGVpZ2h0IiwiaW5pdGlhbFdpZHRoIiwid2lkdGgiLCJ3aW5kb3dIZWlnaHQiLCJpbm5lckhlaWdodCIsIndpbmRvd1dpZHRoIiwiZmlndXJlQm91bmRpbmdSZWN0IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwiZmlndXJlQXNwZWN0UmF0aW8iLCJ3aW5kb3dBc3BlY3RSYXRpbyIsImZpbmFsV2lkdGgiLCJsZWZ0IiwidG9wIiwiZmluYWxIZWlnaHQiLCJzZXRUaW1lb3V0IiwibG9hZFJhdyIsIm9mZnNldCIsImFicyIsInN0b3BQcm9wYWdhdGlvbiIsImZ1bGxJbWFnZSIsIkltYWdlIiwic3JjIiwiZGF0YXNldCIsImdldFNpemUiLCJvbmxvYWQiLCJhcHBlbmRDaGlsZCIsInJhd0ltYWdlIiwicmF3Iiwic2l6ZUluZGV4Iiwic2l6ZXMiLCJkZXZpY2VQaXhlbFJhdGlvIiwiZGVmaW5lIiwiYW1kIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkNBQUMsU0FBVUEsR0FDVCxZQU9BLFNBQVNDLEtBQ1AsR0FBSUMsR0FDQUMsRUFBS0MsU0FBU0MsY0FBYyxlQUM1QkMsR0FDRkMsaUJBQWtCLHNCQUNsQkMsY0FBZSxnQkFDZkMsYUFBYyxrQkFDZEMsWUFBYSxpQkFDYkMsV0FBWSxnQkFFZCxLQUFLVCxJQUFLSSxHQUNSLEdBQUlBLEVBQVlNLGVBQWVWLElBQ1RXLFNBQWhCVixFQUFHVyxNQUFNWixHQUNYLE1BQU9JLEdBQVlKLEdBdUIzQixRQUFTYSxHQUFpQkMsR0FxQnhCLE1BcEJBQyxNQUFLQyxHQUFLLFVBQVlDLEtBQUtDLE1BQU1ELEtBQUtFLFNBQVNGLEtBQUtHLElBQUksR0FBRyxJQUFJQyxXQUMvRE4sS0FBS08sWUFBYSxFQUNsQlAsS0FBS0QsT0FBU0EsRUFDZEMsS0FBS1EsTUFBUXJCLFNBQVNzQix1QkFBdUIsU0FBUyxHQUN0RFQsS0FBS1UsZ0JBQWtCQyxPQUFPQyxXQUM5QlosS0FBS2EsbUJBQXFCN0IsSUFDMUJnQixLQUFLYyxXQUFjZCxLQUFLRCxPQUFPZ0IsVUFBVUMsUUFBUSxnQkFBa0IsRUFDbkVoQixLQUFLaUIsWUFBZWpCLEtBQUtELE9BQU9nQixVQUFVQyxRQUFRLGlCQUFtQixFQUNyRWhCLEtBQUtrQixXQUFjbEIsS0FBS0QsT0FBT2dCLFVBQVVDLFFBQVEsZ0JBQWtC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biAgJ3VzZSBzdHJpY3QnO1xuXG4gIC8qKlxuICAgKiBGaW5kIHRoZSBDU1MgdHJhbnNpdGlvbiBlbmQgZXZlbnQgdGhhdCB3ZSBzaG91bGQgbGlzdGVuIGZvci5cbiAgICpcbiAgICogQHJldHVybnMge3N0cmluZ30gdCAtIHRoZSB0cmFuc2l0aW9uIHN0cmluZ1xuICAgKi9cbiAgZnVuY3Rpb24gX3doaWNoVHJhbnNpdGlvbkVuZEV2ZW50KCkge1xuICAgIHZhciB0O1xuICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zha2VlbGVtZW50Jyk7XG4gICAgdmFyIHRyYW5zaXRpb25zID0ge1xuICAgICAgV2Via2l0VHJhbnNpdGlvbjogJ3dlYmtpdFRyYW5zaXRpb25FbmQnLFxuICAgICAgTW96VHJhbnNpdGlvbjogJ3RyYW5zaXRpb25lbmQnLFxuICAgICAgTVNUcmFuc2l0aW9uOiAnbXNUcmFuc2l0aW9uRW5kJyxcbiAgICAgIE9UcmFuc2l0aW9uOiAnb3RyYW5zaXRpb25lbmQnLFxuICAgICAgdHJhbnNpdGlvbjogJ3RyYW5zaXRpb25lbmQnLFxuICAgIH07XG4gICAgZm9yICh0IGluIHRyYW5zaXRpb25zKSB7XG4gICAgICBpZiAodHJhbnNpdGlvbnMuaGFzT3duUHJvcGVydHkodCkpIHtcbiAgICAgICAgaWYgKGVsLnN0eWxlW3RdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICByZXR1cm4gdHJhbnNpdGlvbnNbdF07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBjbGFzcyBtYW5hZ2VzIGEgc2luZ2xlIGltYWdlLiBJdCBrZWVwcyB0cmFjayBvZiB0aGUgaW1hZ2UncyBoZWlnaHQsXG4gICAqIHdpZHRoLCBhbmQgcG9zaXRpb24gaW4gdGhlIGdyaWQuIEFuIGluc3RhbmNlIG9mIHRoaXMgY2xhc3MgaXMgYXNzb2NpYXRlZFxuICAgKiB3aXRoIGEgc2luZ2xlIGltYWdlIGZpZ3VyZSwgd2hpY2ggbG9va3MgbGlrZSB0aGlzOlxuICAgKlxuICAgKiAgIDxmaWd1cmUgY2xhc3M9XCJwcm9ncmVzc2l2ZS1pbWFnZVwiXG4gICAqICAgICAgIGRhdGEtc21hbGw9XCIuLi5cIlxuICAgKiAgICAgICBkYXRhLW1lZGl1bT1cIi4uLlwiXG4gICAqICAgICAgIGRhdGEtbGFyZ2U9XCIuLi5cIlxuICAgKiAgICAgICBkYXRhLXJhdz1cIi4uLlwiPlxuICAgKiAgICAgPGRpdiBjbGFzcz1cImFzcGVjdC1yYXRpby1ob2xkZXJcIiBzdHlsZT1cInBhZGRpbmctYm90dG9tOiAuLi5cIj48L2Rpdj5cbiAgICogICAgIDxpbWcgY2xhc3M9XCJ0aHVtYm5haWxcIiBzcmM9XCIuLi5cIiBhbHQ9XCIuLi5cIj5cbiAgICogICA8L2ZpZ3VyZT5cbiAgICpcbiAgICogQHBhcmFtIHtlbGVtZW50fSBmaWd1cmUgLSB0aGUgPGZpZ3VyZT4gRE9NIGVsZW1lbnQuXG4gICAqIEByZXR1cm5zIHtvYmplY3R9IHRoZSBwcm9ncmVzc2l2ZSBpbWFnZSBvYmplY3RcbiAgICovXG4gIGZ1bmN0aW9uIFByb2dyZXNzaXZlSW1hZ2UoZmlndXJlKSB7XG4gICAgdGhpcy5pZCA9IFwidmlld2VyLVwiICsgTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpKk1hdGgucG93KDEwLDYpKS50b1N0cmluZygpO1xuICAgIHRoaXMudmlld2VyT3BlbiA9IGZhbHNlO1xuICAgIHRoaXMuZmlndXJlID0gZmlndXJlO1xuICAgIHRoaXMuc2NyaW0gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdzY3JpbScpWzBdO1xuICAgIHRoaXMubGFzdFdpbmRvd1dpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgdGhpcy50cmFuc2l0aW9uRW5kRXZlbnQgPSBfd2hpY2hUcmFuc2l0aW9uRW5kRXZlbnQoKTtcbiAgICB0aGlzLmZvcmNlU21hbGwgPSAodGhpcy5maWd1cmUuY2xhc3NOYW1lLmluZGV4T2YoJ2ZvcmNlLXNtYWxsJykgPj0gMCk7XG4gICAgdGhpcy5mb3JjZU1lZGl1bSA9ICh0aGlzLmZpZ3VyZS5jbGFzc05hbWUuaW5kZXhPZignZm9yY2UtbWVkaXVtJykgPj0gMCk7XG4gICAgdGhpcy5mb3JjZUxhcmdlID0gKHRoaXMuZmlndXJlLmNsYXNzTmFtZS5pbmRleE9mKCdmb3JjZS1sYXJnZScpID49IDApO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIGlmIChlLmtleUNvZGUgPT09IDI3IC8qIEVTQyAqLykge1xuICAgICAgICB0aGlzLmNsb3NlVmlld2VyKCk7XG4gICAgICB9XG4gICAgfS5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLmxvYWQoKTtcblxuICAgIGlmICh0aGlzLmZpZ3VyZS5jbGFzc05hbWUuaW5kZXhPZignd2l0aC12aWV3ZXInKSA+PSAwKSB7XG4gICAgICB0aGlzLmZpZ3VyZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub3BlblZpZXdlci5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIFByb2dyZXNzaXZlSW1hZ2UucHJvdG90eXBlLmNsb3NlVmlld2VyID0gZnVuY3Rpb24gKCkge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLm9uU2Nyb2xsKTtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5vblNob3VsZENsb3NlVmlld2VyKTtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLCB0aGlzLm9uU2hvdWxkQ2xvc2VWaWV3ZXIpO1xuICAgIHRoaXMuc2NyaW0ucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uU2hvdWxkQ2xvc2VWaWV3ZXIpO1xuXG4gICAgdGhpcy5maWd1cmUuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLnRyYW5zaXRpb25FbmRFdmVudCwgZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKGRvY3VtZW50LmJvZHkuY2xhc3NOYW1lLmluZGV4T2YodGhpcy5pZCkgPT0gLTEpIHtcbiAgICAgICAgdGhpcy52aWV3ZXJPcGVuID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZmlndXJlLmNsYXNzTmFtZSA9IHRoaXMuZmlndXJlLmNsYXNzTmFtZVxuICAgICAgICAgIC5yZXBsYWNlKCdpcy1vcGVuJywgJycpXG4gICAgICAgICAgLnJlcGxhY2UoL15cXHMrfFxccyskL2csICcnKTtcbiAgICAgICAgdGhpcy5maWd1cmUuc3R5bGUuekluZGV4ID0gJyc7XG4gICAgICB9XG4gICAgfS5iaW5kKHRoaXMpKTtcblxuICAgIC8vIEJlZ2luIHRyYW5zaXRpb25cbiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTmFtZSA9IGRvY3VtZW50LmJvZHkuY2xhc3NOYW1lXG4gICAgICAucmVwbGFjZSh0aGlzLmlkLCAnJylcbiAgICAgIC5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLCAnJyk7XG4gICAgdGhpcy5maWd1cmUuc3R5bGUudHJhbnNmb3JtID0gJyc7XG4gIH07XG5cbiAgUHJvZ3Jlc3NpdmVJbWFnZS5wcm90b3R5cGUub3BlblZpZXdlciA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoZG9jdW1lbnQuYm9keS5jbGFzc05hbWUuaW5kZXhPZih0aGlzLmlkKSA+PSAwKSB7XG4gICAgICB0aGlzLmNsb3NlVmlld2VyKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy52aWV3ZXJPcGVuID0gdHJ1ZTtcblxuICAgIC8vIEluaXRpYWwgVmFsdWVzXG4gICAgdmFyIGZpZ3VyZVN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUodGhpcy5maWd1cmUpO1xuICAgIHZhciBpbml0aWFsSGVpZ2h0ID0gcGFyc2VGbG9hdChmaWd1cmVTdHlsZS5oZWlnaHQpO1xuICAgIHZhciBpbml0aWFsV2lkdGggPSBwYXJzZUZsb2F0KGZpZ3VyZVN0eWxlLndpZHRoKTtcbiAgICB2YXIgd2luZG93SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuICAgIHZhciB3aW5kb3dXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICAgIHZhciBmaWd1cmVCb3VuZGluZ1JlY3QgPSB0aGlzLmZpZ3VyZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIC8vIENvbXB1dGVkIFZhbHVlc1xuICAgIHZhciBmaWd1cmVBc3BlY3RSYXRpbyA9IGluaXRpYWxXaWR0aCAvIGluaXRpYWxIZWlnaHQ7XG4gICAgdmFyIHdpbmRvd0FzcGVjdFJhdGlvID0gd2luZG93V2lkdGggLyB3aW5kb3dIZWlnaHQ7XG4gICAgdmFyIHNjYWxlO1xuICAgIHZhciB0cmFuc2xhdGVYO1xuICAgIHZhciB0cmFuc2xhdGVZO1xuXG4gICAgaWYgKHdpbmRvd0FzcGVjdFJhdGlvID49IGZpZ3VyZUFzcGVjdFJhdGlvKSB7XG4gICAgICAvLyBJbWFnZSB3aWxsIGZpbGwgdXAgdmVydGljYWwgc3BhY2VcbiAgICAgIHNjYWxlID0gd2luZG93SGVpZ2h0IC8gaW5pdGlhbEhlaWdodDtcbiAgICAgIHZhciBmaW5hbFdpZHRoID0gaW5pdGlhbFdpZHRoICogc2NhbGU7XG4gICAgICB0cmFuc2xhdGVYID0gKHdpbmRvd1dpZHRoIC0gZmluYWxXaWR0aCkgLyAyIC0gZmlndXJlQm91bmRpbmdSZWN0LmxlZnQ7XG4gICAgICB0cmFuc2xhdGVZID0gZmlndXJlQm91bmRpbmdSZWN0LnRvcCAqIC0xO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEltYWdlIHdpbGwgZmlsbCB1cCBob3Jpem9udGFsIHNwYWNlXG4gICAgICBzY2FsZSA9IHdpbmRvd1dpZHRoIC8gaW5pdGlhbFdpZHRoO1xuICAgICAgdmFyIGZpbmFsSGVpZ2h0ID0gaW5pdGlhbEhlaWdodCAqIHNjYWxlO1xuICAgICAgdHJhbnNsYXRlWSA9ICh3aW5kb3dIZWlnaHQgLSBmaW5hbEhlaWdodCkgLyAyIC0gZmlndXJlQm91bmRpbmdSZWN0LnRvcDtcbiAgICAgIHRyYW5zbGF0ZVggPSBmaWd1cmVCb3VuZGluZ1JlY3QubGVmdCAqIC0xO1xuICAgIH1cblxuICAgIC8vIEFwcGx5IERPTSB0cmFuc2Zvcm1hdGlvbnNcbiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTmFtZSArPSAnICcgKyB0aGlzLmlkO1xuICAgIHRoaXMuZmlndXJlLmNsYXNzTmFtZSArPSAnIGlzLW9wZW4nO1xuICAgIHRoaXMuZmlndXJlLnN0eWxlLnpJbmRleCA9ICc4MDAnO1xuICAgIHRoaXMuZmlndXJlLnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGUzZCgnICsgdHJhbnNsYXRlWCArICdweCwnICtcbiAgICAgIHRyYW5zbGF0ZVkgKyAncHgsMCkgc2NhbGUoJyArIHNjYWxlICsgJyknO1xuXG4gICAgLy8gTG9hZCBSYXcgSW1hZ2UgKGxhcmdlISlcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLmZpZ3VyZS5jbGFzc05hbWUuaW5kZXhPZignbG9hZGVkLXJhdycpIDw9IDApIHtcbiAgICAgICAgLy8gVGhlcmUgaXMgYSBsYXJnZXIgaW1hZ2UgdG8gbG9hZC5cbiAgICAgICAgdGhpcy5sb2FkUmF3KCk7XG4gICAgICB9XG4gICAgfS5iaW5kKHRoaXMpLCAzMDApO1xuXG4gICAgdGhpcy5vblNjcm9sbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBvZmZzZXQgPSB0aGlzLmZpZ3VyZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3A7XG4gICAgICBpZiAoTWF0aC5hYnMob2Zmc2V0KSA+IDUwKSB7XG4gICAgICAgIHRoaXMuY2xvc2VWaWV3ZXIoKTtcbiAgICAgIH1cbiAgICB9LmJpbmQodGhpcyk7XG5cbiAgICB0aGlzLm9uU2hvdWxkQ2xvc2VWaWV3ZXIgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgdGhpcy5jbG9zZVZpZXdlcigpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9LmJpbmQodGhpcyk7XG5cbiAgICB0aGlzLnNjcmltLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vblNob3VsZENsb3NlVmlld2VyKTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5vblNob3VsZENsb3NlVmlld2VyKTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb3JpZW50YXRpb25jaGFuZ2UnLCB0aGlzLm9uU2hvdWxkQ2xvc2VWaWV3ZXIpO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCB0aGlzLm9uU2Nyb2xsKTtcbiAgfTtcblxuICAvKipcbiAgICogTG9hZCB0aGUgZnVsbCBpbWFnZSBlbGVtZW50IGludG8gdGhlIERPTS5cbiAgICovXG4gIFByb2dyZXNzaXZlSW1hZ2UucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy8gQ3JlYXRlIGEgbmV3IGltYWdlIGVsZW1lbnQsIGFuZCBpbnNlcnQgaXQgaW50byB0aGUgRE9NLlxuICAgIHZhciBmdWxsSW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICBmdWxsSW1hZ2Uuc3JjID0gdGhpcy5maWd1cmUuZGF0YXNldFt0aGlzLmdldFNpemUoKV07XG4gICAgZnVsbEltYWdlLmNsYXNzTmFtZSA9ICdmdWxsJztcbiAgICBmdWxsSW1hZ2Uub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5maWd1cmUuY2xhc3NOYW1lICs9ICcgbG9hZGVkJztcbiAgICB9LmJpbmQodGhpcyk7XG5cbiAgICB0aGlzLmZpZ3VyZS5hcHBlbmRDaGlsZChmdWxsSW1hZ2UpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBMb2FkIHRoZSByYXcgaW1hZ2UgZWxlbWVudCBpbnRvIHRoZSBET00uXG4gICAqL1xuICBQcm9ncmVzc2l2ZUltYWdlLnByb3RvdHlwZS5sb2FkUmF3ID0gZnVuY3Rpb24gKCkge1xuICAgIC8vIENyZWF0ZSBhIG5ldyBpbWFnZSBlbGVtZW50LCBhbmQgaW5zZXJ0IGl0IGludG8gdGhlIERPTS5cbiAgICB2YXIgcmF3SW1hZ2UgPSBuZXcgSW1hZ2UoKTtcblxuICAgIC8vIG5vdCBhY3R1YWxseSByYXcsIGJlY2F1c2UgZGFtbiwgdGhhdCdzIGV4cGVuc2l2ZS5cbiAgICByYXdJbWFnZS5zcmMgPSB0aGlzLmZpZ3VyZS5kYXRhc2V0LnJhdztcbiAgICByYXdJbWFnZS5jbGFzc05hbWUgPSAncmF3JztcbiAgICByYXdJbWFnZS5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmZpZ3VyZS5jbGFzc05hbWUgKz0gJyBsb2FkZWQtcmF3JztcbiAgICB9LmJpbmQodGhpcyk7XG5cbiAgICB0aGlzLmZpZ3VyZS5hcHBlbmRDaGlsZChyYXdJbWFnZSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIENob29zZSB0aGUgc2l6ZSBvZiBpbWFnZSB0byBsb2FkIGJhc2VkIG9uIHRoZSB3aW5kb3cgd2lkdGguXG4gICAqL1xuICBQcm9ncmVzc2l2ZUltYWdlLnByb3RvdHlwZS5nZXRTaXplID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLmZvcmNlU21hbGwpIHtcbiAgICAgIHJldHVybiAnc21hbGwnO1xuICAgIH0gZWxzZSBpZiAodGhpcy5mb3JjZU1lZGl1bSkge1xuICAgICAgcmV0dXJuICdtZWRpdW0nO1xuICAgIH0gZWxzZSBpZiAodGhpcy5mb3JjZUxhcmdlKSB7XG4gICAgICByZXR1cm4gJ2xhcmdlJztcbiAgICB9XG5cbiAgICB2YXIgc2l6ZXMgPSBbJ3NtYWxsJywgJ21lZGl1bScsICdsYXJnZSddO1xuICAgIHZhciBzaXplSW5kZXg7XG4gICAgaWYgKHRoaXMubGFzdFdpbmRvd1dpZHRoIDwgNzY4KSB7XG4gICAgICBzaXplSW5kZXggPSAwOyAvLyBzbWFsbFxuICAgIH0gZWxzZSBpZiAodGhpcy5sYXN0V2luZG93V2lkdGggPCAxNDQwKSB7XG4gICAgICBzaXplSW5kZXggPSAxOyAvLyBtZWRpdW1cbiAgICB9IGVsc2Uge1xuICAgICAgc2l6ZUluZGV4ID0gMjsgLy8gbGFyZ2U7XG4gICAgfVxuXG4gICAgLy8gUmV0aW5hIGRldmljZXMgc2hvdWxkIGhhdmUgbGFyZ2VyIHBpeGVsIGRlbnNpdGllcy5cbiAgICBpZiAod2luZG93LmRldmljZVBpeGVsUmF0aW8gPiAxICYmIHNpemVJbmRleCA8IDIpIHtcbiAgICAgIHNpemVJbmRleCArPSAxO1xuICAgIH1cblxuICAgIHJldHVybiBzaXplc1tzaXplSW5kZXhdO1xuICB9O1xuXG4gIC8vIEV4cG9ydCBQcm9ncmVzc2l2ZUltYWdlIGludG8gdGhlIGdsb2JhbCBzY29wZS5cbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgIGRlZmluZShQcm9ncmVzc2l2ZUltYWdlKTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gUHJvZ3Jlc3NpdmVJbWFnZTtcbiAgfSBlbHNlIHtcbiAgICBnbG9iYWwuUHJvZ3Jlc3NpdmVJbWFnZSA9IFByb2dyZXNzaXZlSW1hZ2U7XG4gIH1cblxufSh0aGlzKSk7XG4iXX0=
